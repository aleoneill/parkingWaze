<!DOCTYPE html>
<html>
    <head>
        <title>Parking Waze</title>
        <link rel="stylesheet" href="/css/styles.css" />
        <script src="https://code.jquery.com/jquery-3.1.0.js"></script>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.js"></script>
    </head>
    <body>
        <a class="button fadeIn fourth" href="/user" style="color:black;">Back</a>
        <a class="button fadeIn fourth" href="/" style="color:black;">Log Out</a>
        <div class="header1">
            <h3>Results</h3>
        </div>
        <div class="wrapper fadeInDown">
            <div id="formContent">
                {{#each nextClass}}
                    <h2>Welcome {{this.userid}}, our records show that your next class is {{this.buildingname}} in {{this.location}} at {{this.time}}</h2>
                    <h2>We recommend parking at {{this.lot1}}, {{this.lot2}}, or {{this.lot3}}. These lots are the closest to {{this.location}}</h2>
                    <h3>Happy sharking!</h3>
                {{/each}}
            </div>
        </div>
        
        <br><button class="button1" id="displayMap">Continue</button><br><br>
        <span id="buttonWasClicked"></span>
        
        <div class="mapouter" id="popUpMap">
            <div class="gmap_canvas">
                <iframe width="600" height="500" id="gmap_canvas"
                        src="https://maps.google.com/maps?q=university%20of%20san%20francisco&t=&z=13&ie=UTF8&iwloc=&output=embed"
                        frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe>
                <a href="https://www.embedgooglemap.net/blog/nordvpn-coupon-code/"></a>
            </div><br>
            <style>
                .mapouter{position:relative;text-align:right;height:500px;width:600px;margin:auto;display:none}
                .gmap_canvas {overflow:hidden;background:none!important;height:500px;width:600px;}
            </style>
        </div>
        
        <script>
            // FOR TIMEPICKER
            $(document).ready(function() {
                $('input.timepicker').timepicker({});
            });
        
            $('.timepicker').timepicker({
                timeFormat: 'h:mm p',
                interval: 15,
                minTime: '0',
                maxTime: '10:00pm',
                defaultTime: '11',
                startTime: '0:00',
                dynamic: false,
                dropdown: true,
                scrollbar: true
            });
        
            function showMap (results) {
                let lot1 = `csumb%20parking%20lot%20${results[0].lot1}`;
                // let lot2 = `csumb%20parking%20lot%20${results[0].lot2}`;
                // let lot3 = `csumb%20parking%20lot%20${results[0].lot3}`;
                let url = `https://maps.google.com/maps?q=${lot1}&t=&z=13&ie=UTF8&iwloc=&output=embed`;
                document.getElementById("popUpMap").style.display = "block";
                document.getElementById('gmap_canvas').src=`${url}`;
            }
        
            // DISPLAY MAP BUTTON ON CLICK
            $("#displayMap").on("click", function(e) {
                // CHECK IF USER INPUTED ALL VALUES
                if($("#location").val() == "") {
                    $("#buttonWasClicked").html("Error, missing selection above").css("color", "red");
                } else {
                    $("#buttonWasClicked").html("One second....<br><br>").css("color", "green");
        
                    // GET THE LOTS NEAR THE BUILDING
                    $.ajax({
                        type: "POST",
                        url: "/umap",
                        dataType: "json",
                        contentType: "application/json",
                        data: JSON.stringify({
                            "location": $("#location").val(),
                        }),
                        success: function(result, status) {
                            if (result.successful) {
                                showMap(result.results);
                            }
                            else {
                                // Show an error message or something and stay here
                                $('#message').html("error").css("color", "red");
                                $('#message').show();
                            }
                        },
                        error: function(xhr, status, message) {
                            console.log("error: ", xhr.responseText);
                        }
                    });
                }
            });
        </script>
    </body>
</html>