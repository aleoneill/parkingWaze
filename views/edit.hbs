<!DOCTYPE html>
<html>
    <head>
        <title>Parking Waze</title>
        <link rel="stylesheet" href="/css/styles.css" />
        <script src="https://code.jquery.com/jquery-3.1.0.js"></script>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.js"></script>
    </head>
    <body>
        <div class="header">
            <h1>Edit Profile</h1>
        </div>
        <div class="wrapper fadeInDown">
            <div id="formContent">
                <form>
                    {{!-- OLD PASSWORD --}}
                    <label for="oldPassword">Old Password</label>
                    <input type="password" id="oldPassword" class="fadeIn first" name="oldPassword" required><br><br>
                    
                    {{!-- NEW PASSWORD --}}
                    <label for="newPassword">New Password</label>
                    <input type="password" id="newPassword" class="fadeIn second" name="newPassword" required>
                    <div id="passwordMessage" style="display:none; color:green">
                        Must contain at least one number, one uppercase letter,<br> one lowercase letter, and must be at least 8 character long<br><br>
                    </div><br><br>
                    <input type="submit" id="save" class="button fadeIn third" value="Save Changes" onclick="window.location.href='/user'">
                    <span id="errorMessage"></span>
                    <span id="successMessage"></span>
                </form>
            </div>
        </div>
        
        <script>
            $("#save").on("click", function(e) {
                e.preventDefault(); // Do not submit until I am ready
                let oldPassword = $("#oldPassword").val();
                let newPassword = $("#newPassword").val();
                $.ajax({
                    type: "POST",
                    url: "/edit",
                    dataType: "json",
                    contentType: "application/json",
                    data: JSON.stringify({
                        "oldPassword": oldPassword,
                        "newPassword": newPassword
                    }),
                    success: function(result, status) {
                        if (result.successful) {
                            window.location.href = '/user'; // This will navigate to wherever i say...
                            alert("Password updated");
                        }
                        else {
                            // Show an error message or something and stay here
                            $('#errorMessage').html(result.message).css("color", "red");
                            $('#errorMessage').show();
                        }
                    },
                    error: function(xhr, status, message) {
                        console.log("error: ", xhr.responseText);
                    }
                });
            });
        </script>
    </body>
</html>