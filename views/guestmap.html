<% include partials/header %>

    <div class="backButton">
        <a id="backButton" href="/">
            <p>Back</p>
        </a>
    </div>
    <div class="header1">
        <h1>Parking Waze</h1>
    </div>

    <h2>Time of Arrival on Campus?</h2>
    <form id="arrival">
        <input type="text" class="timepicker" name="time" id="timeOfArrival" />
    </form>
    <br><br>
    <h2>Location of Next Class:</h2>
    <div class="buildings">
        <div class="select">
            <select id="buildingChoice">
                <option value="">Select One</option>
                <option value="506">Business and Information Technology (BIT)</option>
                <option value="508">Library</option>
                <option value="504">College of Arts, Humanities, and Social Sciences (CAHSS)</option>
                <option value="90">Otter Sports Center (Gym)</option>
                <option value="71">Visual and Public Arts (East)</option>
                <option value="72">Visual and Public Arts (Center)</option>
                <option value="73">Visual and Public Arts (West)</option>
                <option value="82">Valley Hall</option>
                <option value="86">Ocean Hall</option>
                <option value="53">Chapman</option>
                <option value="46">Harbor Hall</option>
                <option value="45">Coast Hall</option>
                <option value="44">Pacific Hall</option>
                <option value="30">Music Hall</option>
                <option value="49">World Languages North</option>
                <option value="48">World Languages South</option>
                <option value="490">Oaks Hall</option>
                <option value="27">Cinematic Arts & Technology</option>
            </select>
        </div>
    </div>
    <br><br>
    <h2>How Long Are You Planning on Staying?</h2>
    <div class="length">
        <div class="select">
            <select id="lengthOfStay">
                <option value = "">Select One</option>
                <option value = "30">30 min.</option>
                <option value = "45">45 min.</option>
                <option value = "1">1 hr.</option>
                <option value = "2">2 hrs.</option>
                <option value = "3">3+ hrs.</option>
            </select><br>
        </div>
    </div><br><br>

    <button class="button1" id="displayMap">Continue</button><br><br>
    <span id="buttonWasClicked"></span>
    <p id="demo"></p><br><br>

    <script>
        // FOR TIMEPICKER  
        $(document).ready(function() {
            $('input.timepicker').timepicker({});
        });

        $('.timepicker').timepicker({
            timeFormat: 'h:mm p',
            interval: 15,
            minTime: '0',
            maxTime: '10:00pm',
            defaultTime: '11',
            startTime: '0:00',
            dynamic: false,
            dropdown: true,
            scrollbar: true
        });

        // FUNCTIONS FOR GETTING USER'S LOCATION 
        var x = document.getElementById("demo");

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition);
            } else {
                x.innerHTML = "Geolocation is not supported by this browser.";
            }
        }

        function showPosition(position) {
            x.innerHTML = "Latitude: " + position.coords.latitude +
                "<br>Longitude: " + position.coords.longitude;
        }

        // DISPLAY MAP BUTTON ON CLICK 
        $("#displayMap").on("click", function(e) {
             e.preventDefault();
            // CHECK IF USER INPUTED ALL VALUES 
            if($("#timeOfArrival").val() == "" || $("#buildingChoice").val() == "" || $("#lengthOfStay").val() == "") {
                $("#buttonWasClicked").html("Error, missing selection above").css("color", "red"); 
            } else {
                $("#buttonWasClicked").html("One second....").css("color", "green"); 
                getLocation(); 
                $.ajax({
                type: "POST",
                url: "/gmap",
                dataType: "json",
                contentType: "application/json",
                data: JSON.stringify({
                    "building": $("#buildingChoice").val(), 
                }),
                success: function(result, status) {
                    if (result.successful) {
                        window.location.href = '/'; // This will navigate to wherever i say...
                    }
                    else {
                        // Show an error message or something and stay here
                        $('#message').html(result.message).css("color", "red");
                        $('#message').show();
                    }
                },
                error: function(xhr, status, message) {
                    console.log("error: ", xhr.responseText);
                }
            });
            }
            
        });
    </script>

    <% include partials/footer %>
