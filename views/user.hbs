<!DOCTYPE html>
<html>
    <head>
        <title>Parking Waze</title>
        <link rel="stylesheet" href="/css/styles.css" />
        <script src="https://code.jquery.com/jquery-3.1.0.js"></script>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.js"></script>
    </head>
    
    <body>
        <button id="edit" onclick="window.location.href='/edit'">Edit Profile</button>
        <button id="logout" onclick="window.location.href='/'">Log Out</button>
        
        <div class="wrapper fadeInDown">
            <div class="header">
                <h1>Current Schedule</h1>
            </div>
            <table id="formContent">
                {{#each class}}
                <tr>
                    <td>{{this.location}}</td>
                    <td>{{this.name}}</td>
                    <td>{{this.time}}</td>
                    <td><button id={{this.name}}>Delete Class</button></td>
                </tr>
                {{/each}}
            </table>
        </div>
        
        <div class="header">
            <h1>Add Class</h1>
        </div>
        <div class="wrapper fadeInDown">
            <div id="formContent">
                <form><br>
                    <label for="location">Location of Class:</label><br>
                    <select id="location" class="fadeIn third">
                        <option value="">Select One</option>
                        {{#each buildings}}
                            <option value={{this.number}}>{{this.name}}</option>
                        {{/each}} 
                    </select><br>
                    <label for="className">Class Title</label><br>
                    <input type="text" id="className" class="fadeIn fourth" name="className" required>
                    <label for="time">Time</label><br>
                    <input type="text" class="timepicker" name="time" id="time" />
                    <input type="submit" id="addClass" class="button fadeIn sixth" value="Add Class">
                    <span id="errorMessage"></span>
                </form>
            </div>
        </div><br>
        
        <button onclick="window.location.href='/umap'">Verify Schedule</button>
        
        <script>
            $(document).ready(function() {
                $('input.timepicker').timepicker({});
            });
        
            $('.timepicker').timepicker({
                timeFormat: 'h:mm p',
                interval: 60,
                minTime: '0',
                maxTime: '10:00pm',
                defaultTime: '11',
                startTime: '0:00',
                dynamic: false,
                dropdown: true,
                scrollbar: true
            });
        
            $("#addClass").on("click", function(e) {
                e.preventDefault(); // Do not submit until I am ready
                
                let location = $("#location").val();
                let name = $("#className").val();
                let time = $("#time").val();
                
                if(location == "" || name == "" || time == "") {
                    $("#errorMessage").html("<br>Missing selection above").css("color", "red"); 
                } else { 
                    $.ajax({
                        type: "POST",
                        url: "/user",
                        dataType: "json",
                        contentType: "application/json",
                        data: JSON.stringify({
                            "location": location,
                            "name": name,
                            "time": time
                        }),
                        success: function(result, status) {
                            if (result.successful) {
                                window.location.href = '/user'; // This will navigate to wherever i say...
                                $("#errorMessage").html("<br>Success!").css("color", "green"); 
                            }
                            else {
                                // Show an error message or something and stay here
                                $('#errorMessage').html(result.message).css("color", "red");
                                $('#errorMessage').show();
                            }
                        },
                        error: function(xhr, status, message) {
                            console.log("error: ", xhr.responseText);
                        }
                    });
                } 
            });
        </script>
    </body>
</html> 